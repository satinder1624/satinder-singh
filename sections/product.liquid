<section class="homeProductCollection">
  <div class="container">
    <div class="productGrid">
      {% assign collection = collections.frontPage %}
      {% if collection.products.size > 0 %}
        {% for product in collection.products %}
          <div class="productItem">
            <div class="productImageWrapper">
              <img src="{{ product.featured_image | img_url: '500x500' }}" alt="{{ product.title }}" width="" height="">
              <div
                class="plusOverlay"
                data-product-id="{{ forloop.index }}"
                {% comment %} Postioning based on index {% endcomment %}
                style="
                {% if forloop.index == 1 %}
                    top: 205px; right: 192px;
                {% elsif forloop.index == 2 %}
                    top: 150px; right: 140px;
                {% elsif forloop.index == 3 %}
                    top: 90px; right: 200px;
                {% elsif forloop.index == 4 %}
                    top: 80px; right: 170px;
                {% elsif forloop.index == 5 %}
                    top: 80px; right: 230px;
                {%else%}
                    top: 100px; right: 170px;
                {% endif %}
                "
              >
                <span class="plusIcon">+</span>
              </div>
            </div>
          </div>
        {% comment %} Dialog modal for product info {% endcomment %}
        <dialog class="productModal" id="modal-{{ forloop.index }}">
            <div class="modalContent">
                <span class="closeModal" data-product-id="{{ forloop.index }}">x</span>
                {% comment %} Product info container {% endcomment %}
                <div class="productInfoContainer">
                    <div>
                        <img src="{{ product.featured_image | img_url: '150x400' }}" alt="{{ product.title }}" width="" height="">
                    </div>
                    <div class="productDetails">
                        <span class="productTitle">{{ product.title }}</span>
                        <span class="productPrice">{{ product.price | money_with_currency}}</span>
                        <span class="productDescription">{{ product.description | strip_html | truncate: 100 }}</span>
                    </div>
                </div>
            </div>
        </dialog>
        {% endfor %}
      {% else %}
        <p>No products, sorry!</p>
      {% endif %}
    </div>
  </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function(){
        let plusOverlays = document.querySelectorAll('.plusOverlay')
        let closeModalButtons = document.querySelectorAll('.closeModal')

        // Opening modal
        plusOverlays.forEach(function(overlay){
            overlay.addEventListener('click', function(){
                let productId = this.getAttribute('data-product-id')
                let modal = document.getElementById('modal-' + productId)
                modal.showModal()
            })
        })

        // Closing modal
        closeModalButtons.forEach(function(button){
            button.addEventListener('click', function(){
                let productId = this.getAttribute('data-product-id')
                let modal = document.getElementById('modal-' + productId)
                modal.close()
            })
        })

        // Closing modal when click outside the modal
        window.addEventListener('click', function(event){
            let modals = document.querySelectorAll('.productModal')
            modals.forEach(function(modal){
                if(event.target.tagName === 'DIALOG' && event.target.hasAttribute('open')){
                    modal.close()
                }
            })
        })
    })
</script>
