<section class="homeProductCollection">
  <div class="container">
    <div class="productGrid">
      {% assign collection = collections.frontPage %}
      {% if collection.products.size > 0 %}
        {% for product in collection.products %}
          <div class="productItem">
            <div class="productImageWrapper">
              <img src="{{ product.featured_image | img_url: '500x500' }}" alt="{{ product.title }}" width="" height="">
              <div
                class="plusOverlay"
                data-product-id="{{ forloop.index }}"
                {% comment %} Postioning based on index {% endcomment %}
                style="
                  {% if forloop.index == 1 %}
                      top: 205px; right: 192px;
                  {% elsif forloop.index == 2 %}
                      top: 150px; right: 140px;
                  {% elsif forloop.index == 3 %}
                      top: 90px; right: 200px;
                  {% elsif forloop.index == 4 %}
                      top: 80px; right: 170px;
                  {% elsif forloop.index == 5 %}
                      top: 80px; right: 230px;
                  {%else%}
                      top: 100px; right: 170px;
                  {% endif %}
                "
              >
                <span class="plusIcon">+</span>
              </div>
            </div>
          </div>
          {% comment %} Dialog modal for product info {% endcomment %}
          <dialog class="productModal" id="modal-{{ forloop.index }}">
            <div class="modalContent">
              <span class="closeModal" data-product-id="{{ forloop.index }}">
                <img src="{{ 'cross.png' | asset_url }}" alt="Banner" width="" height="">
              </span>
              {% comment %} Product info container {% endcomment %}
              <div class="productInfoContainer">
                <div class="productImg">
                  <img
                    src="{{ product.featured_image | img_url: '280x280' }}"
                    alt="{{ product.title }}"
                    width=""
                    height=""
                  >
                </div>
                <div class="productDetails">
                  <span class="productTitle">{{ product.title }}</span>
                  <span class="productPrice">{{ product.price | money_with_currency }}</span>
                  <span class="productDescription">{{ product.description | strip_html | truncate: 100 }}</span>
                </div>
              </div>
              {% comment %} Color selection {% endcomment %}
              <div>
                <div color="colorWrapper">
                  <span>Color</span>
                  <div class="colorContainer">
                    {% assign color_option_position = product.options_with_values | where: 'name', 'Color' %}
                    {% if color_option_position %}
                      {% for variant in product.variants %}
                        <div>{{ color_option_position }}</div>
                        {% comment %} <div
                          class="colorBox"
                          data-variant-id="{{ variant.id }}"
                          style="background-color: {{ variant.option{{ option_index }} }}"
                        >
                          <div class="onlyForBorderLeft"></div>
                          <span>{{ variant.option{{ option_index }}}}</span>
                        </div> {% endcomment %}
                      {% endfor %}
                    {% else %}
                      <p>No Colors available</p>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </dialog>
        {% endfor %}
      {% else %}
        <p>No products, sorry!</p>
      {% endif %}
    </div>
  </div>
</section>

{% comment %} To activate color box background {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('.colorBox').forEach(function(box){
      box.addEventListener('click', function() {
        let parent = this.closest('.colorContainer')
        // remove the active class
        parent.querySelectorAll('.colorBox').forEach(function(b){
          b.classList.remove('active')
        })

        // Adding active class to the clicked one
        this.classList.add('active')
      })
    })
  })
</script>

{% comment %} Script for modal action {% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    let plusOverlays = document.querySelectorAll('.plusOverlay');
    let closeModalButtons = document.querySelectorAll('.closeModal');

    // Opening modal
    plusOverlays.forEach(function (overlay) {
      overlay.addEventListener('click', function () {
        let productId = this.getAttribute('data-product-id');
        let modal = document.getElementById('modal-' + productId);
        modal.showModal();
      });
    });

    // Closing modal
    closeModalButtons.forEach(function (button) {
      button.addEventListener('click', function () {
        let productId = this.getAttribute('data-product-id');
        let modal = document.getElementById('modal-' + productId);
        modal.close();
      });
    });

    // Closing modal when click outside the modal
    window.addEventListener('click', function (event) {
      let modals = document.querySelectorAll('.productModal');
      modals.forEach(function (modal) {
        if (event.target.tagName === 'DIALOG' && event.target.hasAttribute('open')) {
          modal.close();
        }
      });
    });
  });
</script>
